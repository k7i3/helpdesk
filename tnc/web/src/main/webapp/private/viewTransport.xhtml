<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<ui:composition template="/layout.xhtml">

    <ui:define name="title">
        <p:outputLabel style="font-size: small">
            Транспорт
        </p:outputLabel>
    </ui:define>

    <ui:define name="content">
        <p:tabView id="transportTabView" dynamic="true" cache="true" style="font-size: small">
            <p:tab title="Транспорт">
                <p:dataTable id="transportTable"
                             widgetVar="transportTable"
                             var="transport"
                             value="#{transportController.accessibleTransport}"
                             varStatus="transportVarStatus"
                             selection="#{transportController.checkboxSelectedTransport}"
                             rowKey="#{transport.id}"
                             emptyMessage="транспорт не найден..."
                             draggableColumns="true"
                             draggableRows="false"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             sortMode="multiple"
                             editable="true"
                             liveResize="true"

                             rows="15"
                             paginator="true"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15,20,30,40,50"

                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal" >
                    <!--filteredValue was deleted and all working better-->
                    <!--filteredValue="{sessionScopedController.filteredTransport}"-->
                    <!--sortBy="null" sortOrder="ascending"-->
                    <!--rowKey="{transport.id}" перестал видеть после добавления varStatus="transportVarStatus"-->

                    <!--TODO change color rowStyleClass="{transport.terminal.number le 7000 ? 'tooday' : 'notTooday'}"-->

                    <!--<c:set var="didBy" value="Администратор"/>-->

                    <c:set var="isAdmin" value="#{securityController.isAdmin()}"/>
                    <c:set var="isModer" value="#{securityController.isModer()}"/>
                    <c:set var="isService" value="#{securityController.isService()}"/>
                    <c:set var="isUser" value="#{securityController.isUser()}"/>

                    <p:ajax event="rowEdit" listener="#{transportController.onRowEdit}" update=":form:msgs">
                        <!--TODO setPropertyActionListener don't work-->
                        <!--<f:setPropertyActionListener value="{didBy}" target="{transportController.didBy}" />-->
                    </p:ajax>
                    <p:ajax event="rowEditCancel" listener="#{transportController.onRowCancel}" update=":form:msgs" />
                    <!--<p:ajax event="sort" oncomplete="PF('transportTable').filter()" update=":form:msgs" />-->

                    <f:facet name="header" >
                        <!--<p:outputPanel style="height: 35px">-->
                        <!--<p:panelGrid>-->
                            <p:toolbar>
                                <f:facet name="left">
                                    <p:commandButton process="@this" title="Добавить транспорт" icon="fa fa-plus" update=":form:addTransportPanel" oncomplete="PF('addTransportDialog').show()" rendered="#{isAdmin or isModer}"/>

                                    <!--<span class="ui-separator">-->
                                        <!--<span class="ui-icon ui-icon-grip-dotted-vertical" />-->
                                    <!--</span>-->

                                    <p:commandButton process="@this" title="Добавить транспорт из файла" icon="fa fa-download" update=":form:addTransportFromFilePanel" oncomplete="PF('addTransportFromFileDialog').show()" rendered="#{isAdmin or isModer}"/>

                                    <!--<span class="ui-separator">-->
                                        <!--<span class="ui-icon ui-icon-grip-dotted-vertical" />-->
                                    <!--</span>-->

                                    <p:commandButton type="button" title="Save" icon="ui-icon-disk" rendered="false"/>
                                    <p:commandButton type="button" title="Delete" icon="ui-icon-trash" rendered="false"/>
                                    <p:commandButton type="button" title="Print" icon="ui-icon-print" rendered="false"/>

                                    <!--<span class="ui-separator">-->
                                        <!--<span class="ui-icon ui-icon-grip-dotted-vertical" />-->
                                    <!--</span>-->

                                    <p:menuButton value="Настройки" rendered="false">
                                        <p:menuitem value="Save"  icon="ui-icon-disk" />
                                        <p:menuitem value="Update"  icon="ui-icon-arrowrefresh-1-w" />
                                        <p:menuitem value="Delete"  icon="ui-icon-close" />
                                        <p:menuitem value="Homepage" url="http://www.primefaces.org" icon="ui-icon-extlink" />
                                    </p:menuButton>
                                </f:facet>

                                <f:facet name="right">
                                    <p:inputText id="globalFilter" onkeyup="PF('transportTable').filter()" placeholder="поиск..."  />

                                    <span class="ui-separator">
                                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                                    </span>

                                    <p:commandButton id="transportToggler" type="button"  icon="ui-icon-calculator" />
                                    <p:columnToggler datasource="transportTable" trigger="transportToggler" />
                                </f:facet>
                            </p:toolbar>
                        <!--</p:panelGrid>-->
                        <!--</p:outputPanel>-->
                    </f:facet>
                    <f:facet name="footer">
                        <h:outputText value="всего в базе: #{fn:length(transportController.accessibleTransport)}" style="font-size: small; text-align:left"/>
                    </f:facet>

                    <p:column headerText="-" selectionMode="multiple" style="width:16px;text-align:center"/>
                    <p:column headerText="-" style="width:16px">
                        <p:rowToggler />
                    </p:column>
                    <p:column headerText="-" style="width:16px" rendered="#{isAdmin or isModer}">
                        <p:rowEditor />
                    </p:column>

                    <p:column headerText="Проект" sortBy="#{transport.transportInfo.project}" filterBy="#{transport.transportInfo.project}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.projects}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.project}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.transportInfo.project}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите проект" validatorMessage="количество символов в указании проекта должно быть от 2 до 255">
                                    <f:validateLength minimum="2" maximum="255"/>
                                    <f:selectItems value="#{transportController.projects}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Филиал" sortBy="#{transport.transportInfo.branch}" filterBy="#{transport.transportInfo.branch}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.branches}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.branch}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.transportInfo.branch}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите филиал" validatorMessage="количество символов в указании филиала должно быть от 2 до 255">
                                    <f:validateLength minimum="2" maximum="255"/>
                                    <f:selectItems value="#{transportController.branches}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Маршрут" sortBy="#{transport.transportInfo.route}" filterBy="#{transport.transportInfo.route}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.routes}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.route}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.transportInfo.route}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите маршрут" validatorMessage="количество символов в указании маршрута должно быть от 1 до 255">
                                    <f:validateLength minimum="1" maximum="255"/>
                                    <f:selectItems value="#{transportController.routes}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Гос. номер" sortBy="#{transport.transportInfo.stateNumber}" filterBy="#{transport.transportInfo.stateNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.stateNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.stateNumber}" style="width:100%" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите гос. номер" validatorMessage="формат гос. номера должен быть: А123БВ102 или А123БВ02 или АБ12302">
                                    <!--<f:validateLength minimum="3" maximum="255"/>-->
                                    <f:validateRegex pattern="^(([А-Я][А-Я])([0-9][0-9][0-9])(02))$|^(([А-Я])([0-9][0-9][0-9])([А-Я][А-Я](02|102)))$"/>
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Гар. номер" sortBy="#{transport.transportInfo.garageNumber}" filterBy="#{transport.transportInfo.garageNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.garageNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.garageNumber}" style="width:100%" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите гар. номер" validatorMessage="количество символов в указании гар. номера должно быть от 1 до 255">
                                    <f:validateLength minimum="1" maximum="255"/>
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Модель" sortBy="#{transport.transportInfo.model}" filterBy="#{transport.transportInfo.model}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.transportModels}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.model}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.transportInfo.model}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите модель транспорта" validatorMessage="количество символов в указании модели транспорта должно быть от 2 до 255">
                                    <f:validateLength minimum="2" maximum="255"/>
                                    <f:selectItems value="#{transportController.transportModels}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Терминал" sortBy="#{transport.terminal.terminalInfo.number}" filterBy="#{transport.terminal.terminalInfo.number}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.number}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputMask value="#{transport.terminal.terminalInfo.number}" mask="9999" style="width:100%" required="true" maxlength="255" requiredMessage="пожалуйста, укажите id терминала" validatorMessage="количество символов в указании id терминала должно быть 4">
                                    <f:validateLength minimum="4" maximum="4"/>
                                </p:inputMask>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Модель" sortBy="#{transport.terminal.terminalInfo.model}" filterBy="#{transport.terminal.terminalInfo.model}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.terminalModels}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.model}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.terminal.terminalInfo.model}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите модель терминала" validatorMessage="количество символов в указании модели терминала должно быть от 2 до 255">
                                    <f:validateLength minimum="2" maximum="255"/>
                                    <f:selectItems value="#{transportController.terminalModels}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Прошивка" sortBy="#{transport.terminal.terminalInfo.firmware}" filterBy="#{transport.terminal.terminalInfo.firmware}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.firmware}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.firmware}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu value="#{transport.terminal.terminalInfo.firmware}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите версию прошивки" validatorMessage="количество символов в указании версии прошивки должно быть от 1 до 255">
                                    <f:validateLength minimum="1" maximum="255"/>
                                    <f:selectItems value="#{transportController.firmware}"/>
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="SN" sortBy="#{transport.terminal.terminalInfo.serialNumber}" filterBy="#{transport.terminal.terminalInfo.serialNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.serialNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.serialNumber}" style="width:100%" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите серийный номер" validatorMessage="количество символов в указании серийного номера должно быть от 1 до 255">
                                    <f:validateLength minimum="1" maximum="255"/>
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Телефон" sortBy="#{transport.terminal.terminalInfo.mobileNumber}" filterBy="#{transport.terminal.terminalInfo.mobileNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.mobileNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputMask value="#{transport.terminal.terminalInfo.mobileNumber}" mask="89999999999" style="width:100%" required="true" maxlength="255" requiredMessage="пожалуйста, укажите телефон" validatorMessage="количество символов в указании телефона должно быть 11">
                                    <f:validateLength minimum="11" maximum="11"/>
                                </p:inputMask>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Связь" sortBy="#{transport.point.pointInfo.date}" filterBy="#{transport.point.pointInfo.date}" filterMatchMode="contains">

                        <!--style="white-space: normal"-->

                        <!--<p:commandButton id="transportPointButton" update=":form:transportPointPanel" oncomplete="PF('transportPointDialog').show()" icon="ui-icon-pin-s" title="View">-->
                            <!--<f:setPropertyActionListener value="{transport.terminal.lastPoint}" target="{transportController.dialogSelectedPoint}" />-->
                        <!--</p:commandButton>-->

                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.point.pointInfo.date}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:calendar id="datetime" value="#{transport.point.pointInfo.date}" pattern="MM/dd/yyyy HH:mm:ss" />
                                <!--<p:inputText value="{transport.point.pointInfo.date}" style="width:100%"/>-->
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Заявка" sortBy="#{transport.currentTicketHeader}" filterBy="#{transport.currentTicketHeader}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItem itemLabel="нет" itemValue="нет" />
                                <f:selectItems value="#{ticketController.allTicketHeaders}" var="ticketHeaders" itemLabel="#{ticketHeaders.toString()}" itemValue="#{ticketHeaders.toString()}"/>
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <h:outputText value="#{transport.currentTicketHeader}" title="последняя заявка"/>
                    </p:column>

                    <p:column headerText="Статус" sortBy="#{transport.currentTicketStatus}" filterBy="#{transport.currentTicketStatus}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItem itemLabel="нет" itemValue="нет" />
                                <f:selectItems value="#{ticketController.ticketStatuses}" var="ticketStatuses" itemLabel="#{ticketStatuses.toString()}" itemValue="#{ticketStatuses.toString()}"/>
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <h:outputText value="#{transport.currentTicketStatus}" title="статус последней заявки"/>
                    </p:column>

                    <!--<p:column headerText="Заявки" sortBy="{transport.tickets.size()}" filterBy="{transport.tickets.size()}" filterMatchMode="contains">-->
                    <p:column headerText="З." sortBy="#{transport.tickets.size()}" style="width:16px">
                        <h:outputText value="#{transport.tickets.size()}" title="количество заявок"/>
                    </p:column>

                    <!--<p:column headerText="Комментарии" sortBy="{transport.comments.size()}" filterBy="{transport.comments.size()}" filterMatchMode="contains">-->
                    <p:column headerText="К." sortBy="#{transport.comments.size()}" style="width:16px">
                        <h:outputText value="#{transport.comments.size()}" title="количество комментариев"/>
                    </p:column>

                    <p:rowExpansion>
                        <p:panelGrid style="margin-bottom: 20px">
                            <p:commandButton icon="fa fa-truck" process="@this" update=":form:showTransportHistoryPanel" oncomplete="PF('showTransportHistoryDialog').show()" rendered="true" title="нажмите, чтобы открыть историю транспорта" style="margin-right: 10px">
                                <f:setPropertyActionListener value="#{transport}" target="#{transportController.unitOfTransport}" />
                            </p:commandButton>

                            <p:commandButton icon="fa fa-bug" process="@this" update=":form:showTerminalHistoryPanel" oncomplete="PF('showTerminalHistoryDialog').show()" rendered="true" title="нажмите, чтобы открыть историю терминала" style="margin-right: 10px">
                                <f:setPropertyActionListener value="#{transport}" target="#{transportController.unitOfTransport}" />
                            </p:commandButton>

                            <p:commandButton icon="fa fa-globe" process="@this" update=":form:showPointPanel" action="#{pointController.initModel}" oncomplete="PF('showPointDialog').show()" title="нажмите, чтобы увидеть транспорт на карте" style="margin-right: 10px">
                                <f:setPropertyActionListener value="#{transport.point}" target="#{pointController.point}" />
                            </p:commandButton>
                        </p:panelGrid>

                        <p:accordionPanel multiple="true" activeIndex="" style="margin-bottom: 20px">
                            <p:tab title="Дополнительное оборудование">
                                <p:panelGrid columns="1" style="border: hidden white; width: auto">
                                    <h:panelGrid columns="1" style="border: hidden white">
                                        <p:panelGrid columns="2" style="width: auto">
                                            <h:outputText value="Тангента:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasPtt? 'В комплекте':'Нет'}" style="display:block" disabled="#{not isAdmin and not isModer}">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasPtt}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Динамик:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasSpeaker? 'В комплекте':'Нет'}" style="display:block" disabled="#{not isAdmin and not isModer}">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasSpeaker}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Информатор:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasInformer? 'В комплекте':'Нет'}" style="display:block" disabled="#{not isAdmin and not isModer}">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasInformer}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Регистратор:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasDvr? 'В комплекте':'Нет'}" style="display:block" disabled="#{not isAdmin and not isModer}">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasDvr}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>
                                        </p:panelGrid>

                                        <p:commandLink value="обновить" process="@parent" update=":form:msgs @parent:@parent" action="#{transportController.doUpdateTransportInfo}" title="нажмите, чтобы сохранить изменения"  rendered="#{isAdmin or isModer}">
                                            <f:setPropertyActionListener value="#{transport}" target="#{transportController.unitOfTransport}" />
                                            <!--<f:setPropertyActionListener value="{didBy}" target="{transportController.didBy}" />-->
                                        </p:commandLink>
                                    </h:panelGrid>
                                </p:panelGrid>
                            </p:tab>

                            <p:tab title="Комментарии к транспорту">
                                <p:scrollPanel mode="native" style="width: auto; height: auto; max-height: 300px; max-width: 100%; margin-bottom: 10px; padding: 10px">
                                    <ui:repeat value="#{transport.comments}" var="transportComment">
                                        <p:fieldset legend="(#{transportComment.creation.date}) #{transportComment.creation.didBy}:" toggleable="true" toggleSpeed="500" collapsed="false" style="margin-bottom: 10px; width: auto; max-width: 100%" >
                                            <p:panelGrid>
                                                <h:outputText value="#{transportComment.commentInfo.content}" style="width:auto; display:block; word-wrap: break-word; font-style: italic; white-space: normal"/> <!--word-break: break-all;-->
                                                <h:outputText value=" изменен: #{transportComment.commentInfo.modification.date}" style="width:auto; display:block; word-wrap: break-word; font-style: normal; font-weight: bold; white-space: normal"/>
                                            </p:panelGrid>
                                        </p:fieldset>
                                    </ui:repeat>
                                </p:scrollPanel>
                                <p:inputTextarea rows="3" value="#{ticketController.commentContent}" counter="transportCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255" style="display:block; margin-bottom: 10px; width: 50%">
                                    <f:validateLength minimum="3" maximum="255"/>
                                </p:inputTextarea>
                                <h:outputText id="transportCommentContentCounter" style="display:block; margin-bottom: 10px"/>
                                <p:commandButton id="transportCommentButton" process="@parent" update="@parent:@child(0) @parent:@child(1) :form:msgs" action="#{ticketController.doAddTransportComment(transport)}" value="Отправить" icon="fa fa-send"/>
                            </p:tab>

                            <!--footer="принята: {ticket.acceptance.date} ({ticket.acceptance.didBy}) -->
                            <!--/// закрыта: {ticket.closing.date} ({ticket.closing.didBy}) -->
                            <!--/// удалена: {ticket.deletion.date} ({ticket.deletion.didBy}) -->
                            <!--/// последнее изменение: {ticket.ticketInfo.modification.date} ({ticket.ticketInfo.modification.didBy})">-->
                            <p:tab title="Заявки">
                                <ui:repeat value="#{transport.tickets}" var="ticket" varStatus="ticketVarStatus">
                                    <p:panel id="ticketPanel#{ticketVarStatus.index}-#{ticket.id}" collapsed="true" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" widgetVar="ticketPanel#{ticketVarStatus.index}-#{ticket.id}" style="margin-bottom: 10px; width: 100%"
                                            header="#{ticketVarStatus.index + 1} - #{ticket.creation.date} #{ticket.creation.didBy} - #{ticket.ticketInfo.ticketHeader} (#{ticket.ticketInfo.ticketStatus})"
                                            footer="#{ticket.ticketInfo.ticketResults.size() == 0? '' : ticket.ticketInfo.ticketResults}">
                                        <!--footer="последнее изменение: {ticket.ticketInfo.modification.date} {ticket.ticketInfo.modification.didBy}">-->
                                        <!--footer="{empty ticket.acceptance? 'не принята': 'принята:'} {ticket.acceptance.date} {ticket.acceptance.didBy}-->
                                        <!--||| {empty ticket.closing? 'не закрыта': 'закрыта:'} {ticket.closing.date} {ticket.closing.didBy}-->
                                        <!--||| {empty ticket.deletion? 'не удалена': 'удалена:'} {ticket.deletion.date} {ticket.deletion.didBy}-->
                                        <!--||| последнее изменение: {ticket.ticketInfo.modification.date} {ticket.ticketInfo.modification.didBy}">-->
                                        <!--<p:ajax event="close" listener="{panelView.onClose}" update="msgs" />-->
                                        <!--<p:ajax event="toggle" listener="{panelView.onToggle}" update="msgs" />-->
                                        <p:panelGrid columns="1" style="border: hidden white; width: auto">
                                            <h:panelGrid columns="1" style="border: hidden white">
                                                <p:panelGrid columns="2" style="width: auto">
                                                    <h:outputText value="Возможность подачи в Уфу:" style="float: right"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace? 'Есть':'Нет'}" style="display:block" disabled="#{not isAdmin and not isModer and not isUser}">
                                                        <p:selectBooleanButton value="#{ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace}" onLabel="Есть" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close" required="true"/>
                                                    </p:inplace>

                                                    <h:outputText value="Внешний осмотр:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.isInspected? 'Произведен':'Не произведен'}" style="display:block" disabled="#{not isAdmin and not isModer and not isUser}">
                                                        <p:selectBooleanButton value="#{ticket.ticketInfo.ticketDetails.isInspected}" onLabel="Произведен" offLabel="Не произведен" onIcon="ui-icon-check" offIcon="ui-icon-close" required="true"/>
                                                    </p:inplace>

                                                    <h:outputText value="Место подачи:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.place}" style="display:block" disabled="#{not isAdmin and not isModer and not isUser}">
                                                        <p:inputTextarea value="#{ticket.ticketInfo.ticketDetails.place}" rows="3" maxlength="255" required="true" requiredMessage="пожалуйста, укажите место подачи" validatorMessage="количество символов в указании места подачи должно быть от 3 до 255">
                                                            <f:validateLength minimum="3" maximum="255"/>
                                                        </p:inputTextarea>
                                                    </p:inplace>

                                                    <h:outputText value="Телефон водителя:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}" style="display:block" disabled="#{not isAdmin and not isModer and not isUser}">
                                                        <!--<p:inputText value="{ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}"/>-->
                                                        <p:inputMask value="#{ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}" mask="8 (999) 99-99-999" required="true" requiredMessage="пожалуйста, укажите телефон водителя"/>
                                                    </p:inplace>

                                                    <h:outputText value="Телефон ответственного:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}" style="display:block" disabled="#{not isAdmin and not isModer and not isUser}">
                                                        <!--<p:inputText value="{ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}"/>-->
                                                        <p:inputMask value="#{ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}" mask="8 (999) 99-99-999" required="true" requiredMessage="пожалуйста, укажите телефон ответственного"/>
                                                    </p:inplace>
                                                </p:panelGrid>

                                                <p:commandLink validateClient="true" value="обновить" process="@parent" update=":form:msgs @parent:@parent" action="#{ticketController.doUpdateTicketInfo}" title="нажмите, чтобы сохранить изменения" rendered="#{isAdmin or isModer or isUser}">
                                                    <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                    <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                    <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                                                </p:commandLink>
                                            </h:panelGrid>
                                        </p:panelGrid >

                                        <p:scrollPanel mode="native" style="width: auto; height: auto; max-height: 300px; max-width: 100%; margin-bottom: 10px; padding: 10px">
                                            <ui:repeat value="#{ticket.comments}" var="ticketComment">
                                                <p:fieldset legend="(#{ticketComment.creation.date}) #{ticketComment.creation.didBy}:" toggleable="true" toggleSpeed="500" collapsed="false" style="margin-bottom: 10px; width: auto; max-width: 100%">
                                                    <p:panelGrid>
                                                        <h:outputText value="#{ticketComment.commentInfo.content}" style="width:auto; display:block; word-wrap: break-word; font-style: italic; white-space: normal"/> <!--word-break: break-all;-->
                                                        <h:outputText value=" изменен: #{ticketComment.commentInfo.modification.date}" style="width:auto; display:block; word-wrap: break-word; font-style: normal; font-weight: bold; white-space: normal"/>
                                                    </p:panelGrid>
                                                </p:fieldset>
                                            </ui:repeat>
                                        </p:scrollPanel>
                                        <p:inputTextarea rows="3" value="#{ticketController.commentContent}" counter="ticketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255" style="display:block; margin-bottom: 10px; width: 50%">
                                            <f:validateLength minimum="3" maximum="255"/>
                                        </p:inputTextarea>
                                        <h:outputText id="ticketCommentContentCounter" style="display:block; margin-bottom: 10px"/>
                                        <p:commandButton id="ticketCommentButton" process="@parent" update="@parent:@child(2) @parent:@child(3) :form:msgs" action="#{ticketController.doAddTicketComment(ticket)}" value="Отправить" icon="fa fa-send"/>
                                        <!--<f:facet name="options">-->
                                            <!--<p:menu>-->
                                                <!--<p:submenu label="Settings">-->
                                                    <!--<p:menuitem value="Toggle" url="#" icon="ui-icon-newwin" onclick="PF('ticketPanel{transportVarStatus.index}{ticketVarStatus.index}').toggle()" />-->
                                                    <!--<p:menuitem value="Remove" url="#" icon="ui-icon-close" onclick="PF('ticketPanel{transportVarStatus.index}{ticketVarStatus.index}').close()" />-->
                                                <!--</p:submenu>-->
                                            <!--</p:menu>-->
                                        <!--</f:facet>-->
                                        <f:facet name="actions">
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText styleClass="ui-icon ui-icon-help" /></h:commandLink>-->
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" value="удалить" rendered="{empty ticket.deletion}"/>-->

                                            <!--rendered="{empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToAcceptTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer}"-->
                                            <p:commandButton process="@this" action="#{ticketController.doAcceptTicket}" update=":form:transportTabView:transportTable :form:msgs" rendered="#{isAdmin or isModer? empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation : false}" icon="fa fa-check-square-o" title="нажмите, чтобы принять заявку" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                                            </p:commandButton>

                                            <!--rendered="{empty ticket.service and empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToOnServiceTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer}"-->
                                            <p:commandButton process="@this" action="#{ticketController.doOnServiceTicket}" update=":form:transportTabView:transportTable :form:msgs" rendered="#{isAdmin or isModer? empty ticket.service and empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation : false}" icon="fa fa-eye" title="нажмите, чтобы назначить выезд" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                                            </p:commandButton>

                                            <!--rendered="{empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToCloseTicket(ticket)}"-->
                                            <!--disabled="{empty ticket.service? not isAdmin and not isModer : not isAdmin and not isModer and not isService}"-->
                                            <p:commandButton process="@this" update=":form:closeTicketPanel :form:transportTabView:transportTable :form:msgs" oncomplete="PF('closeTicketDialog').show()" rendered="#{empty ticket.service? (isAdmin or isModer? (empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation) : false) : (isAdmin or isModer or isService? (empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation) : false)}" icon="fa fa-thumbs-o-up" title="нажмите, чтобы закрыть заявку" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{sessionScopedController.ticket}" />
                                            </p:commandButton>

                                            <!--rendered="{not empty ticket.service and not empty ticket.closing and fn:length(ticket.repeatedService) == fn:length(ticket.repeatedClosing) and empty ticket.archiving and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToRepeatedOnServiceTicket(ticket)}"-->
                                            <p:commandButton process="@this" update=":form:repeatedOnServiceTicketPanel :form:transportTabView:transportTable :form:msgs" oncomplete="PF('repeatedOnServiceTicketDialog').show()" rendered="#{not empty ticket.service and not empty ticket.closing and fn:length(ticket.repeatedService) == fn:length(ticket.repeatedClosing) and empty ticket.archiving and empty ticket.incorrectness and empty ticket.cancellation? isAdmin or isModer : false}" value="!" icon="fa fa-eye" title="нажмите, чтобы назначить повторный выезд" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{sessionScopedController.ticket}" />
                                            </p:commandButton>

                                            <!--rendered="{not empty ticket.service and not empty ticket.closing and fn:length(ticket.repeatedService) > fn:length(ticket.repeatedClosing) and empty ticket.archiving and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToRepeatedCloseTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer and not isService}"-->
                                            <p:commandButton process="@this" update=":form:repeatedCloseTicketPanel :form:transportTabView:transportTable :form:msgs" oncomplete="PF('repeatedCloseTicketDialog').show()" rendered="#{not empty ticket.service and not empty ticket.closing and fn:length(ticket.repeatedService) > fn:length(ticket.repeatedClosing) and empty ticket.archiving and empty ticket.incorrectness and empty ticket.cancellation? isAdmin or isModer or isService : false}" value="!" icon="fa fa-thumbs-o-up" title="нажмите, чтобы повторно закрыть заявку" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{sessionScopedController.ticket}" />
                                            </p:commandButton>

                                            <!--rendered="{empty ticket.archiving and not empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToArchiveTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer}"-->
                                            <p:commandButton process="@this" action="#{ticketController.doArchiveTicket}" update=":form:transportTabView:transportTable :form:msgs" rendered="#{isAdmin or isModer? empty ticket.archiving and not empty ticket.closing and not empty ticket.acceptance and empty ticket.incorrectness and empty ticket.cancellation : false}" icon="fa fa-archive" title="нажмите, чтобы поместить заявку в архив" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                                            </p:commandButton>

                                            <p:commandButton process="@this" update=":form:showTicketHistoryPanel" oncomplete="PF('showTicketHistoryDialog').show()" rendered="#{isAdmin or isModer or isService}" icon="fa fa-history" title="нажмите, чтобы открыть хронологию заявки" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" style="margin-right: 5px">
                                                <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                            </p:commandButton>

                                            <!--rendered="{empty ticket.archiving and empty ticket.cancellation and empty ticket.incorrectness}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToMarkAsIncorrectTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer}"-->
                                            <p:commandButton process="@this" icon="fa fa-exclamation-triangle" update=":form:markAsIncorrectTicketPanel :form:transportTabView:transportTable :form:msgs" oncomplete="PF('markAsIncorrectTicketDialog').show()" rendered="#{isAdmin or isModer? empty ticket.archiving and empty ticket.cancellation and empty ticket.incorrectness : false}"  title="нажмите, чтобы отметить заявку как невалидную" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" style="float: right; margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{sessionScopedController.ticket}" />
                                            </p:commandButton>

                                            <!--rendered="{empty ticket.archiving and empty ticket.cancellation and empty ticket.incorrectness}"-->
                                            <!--rendered="{ticketController.doCheckForPossibilityToCancelTicket(ticket)}"-->
                                            <!--disabled="{not isAdmin and not isModer and not isUser}"-->
                                            <p:commandButton process="@this" icon="fa fa-ban" update=":form:cancelTicketPanel :form:transportTabView:transportTable :form:msgs" oncomplete="PF('cancelTicketDialog').show()" rendered="#{isAdmin or isUser? empty ticket.archiving and empty ticket.cancellation and empty ticket.incorrectness : false}" title="нажмите, чтобы отменить заявку" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" style="float: right; margin-right: 5px">
                                                <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{sessionScopedController.ticket}" />
                                            </p:commandButton>
                                            <!--style="float: right;"-->
                                        </f:facet>
                                    </p:panel>
                                </ui:repeat>

                                <p:commandButton value="Новая заявка" process="@this" update=":form:openTicketPanel" oncomplete="PF('openTicketDialog').show()" icon="fa fa-plus" rendered="#{ticketController.doCheckForPossibilityToAddTicket(transport)? isAdmin or isUser : false}" title="нажмите, чтобы добавить новую заявку" style="margin-right: 10px">
                                    <f:setPropertyActionListener value="#{transport}" target="#{sessionScopedController.unitOfTransport}" />
                                </p:commandButton>

                            </p:tab>
                        </p:accordionPanel>
                    </p:rowExpansion>
                </p:dataTable>
            </p:tab>

        </p:tabView>

        <p:dialog
                widgetVar="showPointDialog"
                header="Местоположение транспорта:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="50%"
                style="font-size: small">

            <p:outputPanel id="showPointPanel">
                <p:gmap id="gmap" center="#{pointController.point.pointInfo.latitude}, #{pointController.point.pointInfo.longitude}" model="#{pointController.model}" zoom="5" type="HYBRID" style="width:100%; height:500px" />
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="addTransportDialog"
                header="Добавление транспорта:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="addTransportPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">

                    <h:outputText value="Проект:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.project}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите проект" validatorMessage="количество символов в указании проекта должно быть от 2 до 255">
                        <f:validateLength minimum="2" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.projects}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Филиал:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.branch}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите филиал" validatorMessage="количество символов в указании филиала должно быть от 2 до 255">
                        <f:validateLength minimum="2" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.branches}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Гос. номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.transportInfo.stateNumber}" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите гос. номер" validatorMessage="формат гос. номера должен быть: А123БВ102 или А123БВ02 или АБ12302">
                        <!--<f:validateLength minimum="3" maximum="255"/>-->
                        <f:validateRegex pattern="^(([А-Я][А-Я])([0-9][0-9][0-9])(02))$|^(([А-Я])([0-9][0-9][0-9])([А-Я][А-Я](02|102)))$"/>
                    </p:inputText>

                    <h:outputText value="Гар. номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.transportInfo.garageNumber}" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите гар. номер" validatorMessage="количество символов в указании гар. номера должно быть от 1 до 255">
                        <f:validateLength minimum="1" maximum="255"/>
                    </p:inputText>

                    <h:outputText value="Модель транспорта:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.model}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите модель транспорта" validatorMessage="количество символов в указании модели транспорта должно быть от 2 до 255">
                        <f:validateLength minimum="2" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.transportModels}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Маршрут:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.route}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите маршрут" validatorMessage="количество символов в указании маршрута должно быть от 1 до 255">
                        <f:validateLength minimum="1" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.routes}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Тангента:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasPtt}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Динамик:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasSpeaker}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Информатор:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasInformer}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Регистратор:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasDvr}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Терминал:"/>
                    <p:inputMask value="#{transportController.unitOfTransport.terminal.terminalInfo.number}" mask="9999" required="true" maxlength="255" requiredMessage="пожалуйста, укажите id терминала" validatorMessage="количество символов в указании id терминала должно быть 4">
                        <f:validateLength minimum="4" maximum="4"/>
                    </p:inputMask>

                    <h:outputText value="Телефон:"/>
                    <p:inputMask value="#{transportController.unitOfTransport.terminal.terminalInfo.mobileNumber}" mask="89999999999" required="true" maxlength="255" requiredMessage="пожалуйста, укажите телефон" validatorMessage="количество символов в указании телефона должно быть 11">
                        <f:validateLength minimum="11" maximum="11"/>
                    </p:inputMask>

                    <h:outputText value="Модель терминала:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.terminal.terminalInfo.model}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите модель терминала" validatorMessage="количество символов в указании модели терминала должно быть от 2 до 255">
                        <f:validateLength minimum="2" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.terminalModels}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Прошивка:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.terminal.terminalInfo.firmware}" editable="true" required="true" maxlength="255" requiredMessage="пожалуйста, укажите версию прошивки" validatorMessage="количество символов в указании версии прошивки должно быть от 1 до 255">
                        <f:validateLength minimum="1" maximum="255"/>
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.firmware}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Серийный номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.terminal.terminalInfo.serialNumber}" onkeyup="value=value.toUpperCase()" required="true" maxlength="255" requiredMessage="пожалуйста, укажите серийный номер" validatorMessage="количество символов в указании серийного номера должно быть от 1 до 255">
                        <f:validateLength minimum="1" maximum="255"/>
                    </p:inputText>
                </p:panelGrid>

                <p:separator/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{transportController.doAddTransport}" onsuccess="PF('addTransportDialog').hide()" value="Создать" icon="ui-icon-disk" style="float: right"/>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="addTransportFromFileDialog"
                header="Добавление транспорта из файла:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="true"
                width="auto"
                style="font-size: small; max-width: 100%; max-height: 100%">

            <p:outputPanel id="addTransportFromFilePanel">
                <p:fileUpload fileUploadListener="#{transportController.handleFileUpload}" mode="advanced" dragDropSupport="false" update=":form:transportTabView:transportTable" sizeLimit="100000" fileLimit="2" allowTypes="/(\.|\/)(csv)$/" />
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" style="max-height: 500px"/>

                <!--<p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="{transportController.doAddTransport}" onsuccess="PF('addTransportDialog').hide()" value="Создать" icon="ui-icon-disk" style="float: right"/>-->
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="openTicketDialog"
                header="Новая заявка:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="openTicketPanel">
                <p:panelGrid columns="3" styleClass="ui-noborder" style="width: auto">
                    <p:outputLabel for="ticketHeader" value="Причина:" />
                    <p:selectOneListbox id="ticketHeader" converter="ticketHeaderConverter" value="#{ticketController.ticket.ticketInfo.ticketHeader}" required="true" requiredMessage="пожалуйста, укажите причину">
                        <f:selectItems value="#{ticketController.ticketHeaders}" var="ticketHeader" itemLabel="#{ticketHeader.toString()}" itemValue="#{ticketHeader}"/>
                        <!--<p:clientValidator/>-->
                    </p:selectOneListbox>
                    <p:message for="ticketHeader" display="tooltip"/>

                    <p:outputLabel for="possibilityOfServiceAtTheDefaultPlace" value="Возможность подачи в Уфу:" />
                    <p:selectBooleanButton id="possibilityOfServiceAtTheDefaultPlace" value="#{ticketController.ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace}" onLabel="Есть" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close" required="true"/>
                    <p:message for="possibilityOfServiceAtTheDefaultPlace" />

                    <p:outputLabel for="isInspected" value="Внешний осмотр:" />
                    <p:selectBooleanButton id="isInspected" value="#{ticketController.ticket.ticketInfo.ticketDetails.isInspected}" onLabel="Произведен" offLabel="Не произведен" onIcon="ui-icon-check" offIcon="ui-icon-close" required="true"/>
                    <p:message for="isInspected" />

                    <p:outputLabel for="place" value="Место подачи:" />
                    <p:inputTextarea id="place" value="#{ticketController.ticket.ticketInfo.ticketDetails.place}" rows="3" counter="placeCounter" maxlength="255" counterTemplate="(символов осталось: {0})" required="true" requiredMessage="пожалуйста, укажите место подачи" validatorMessage="количество символов в указании места подачи должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                        <!--<p:clientValidator event="keyup"/>-->
                    </p:inputTextarea>
                    <h:outputText id="placeCounter" />

                    <p:outputLabel for="mobileNumberOfDriver" value="Телефон водителя:" />
                    <p:inputMask id="mobileNumberOfDriver" value="#{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}" mask="8 (999) 99-99-999" required="true" requiredMessage="пожалуйста, укажите телефон водителя">
                        <!--<p:clientValidator/>-->
                    </p:inputMask>
                    <p:message for="mobileNumberOfDriver" />

                    <p:outputLabel for="mobileNumberOfAgent" value="Телефон ответственного:" />
                    <p:inputMask id="mobileNumberOfAgent" value="#{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}" mask="8 (999) 99-99-999" required="true" requiredMessage="пожалуйста, укажите телефон ответственного">
                        <!--<p:clientValidator/>-->
                    </p:inputMask>
                    <p:message for="mobileNumberOfAgent" />

                    <p:outputLabel for="commentContent" value="Комментарий:" />
                    <p:inputTextarea id="commentContent" value="#{ticketController.commentContent}" rows="5" counter="commentContentCounter" maxlength="255" counterTemplate="(символов осталось: {0})"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                        <!--<p:clientValidator event="keyup"/>-->
                    </p:inputTextarea>
                    <h:outputText id="commentContentCounter" />
                </p:panelGrid>

                <p:separator/>

                <p:commandButton validateClient="true" process="@parent" update="@parent :form:msgs :form:transportTabView:transportTable" action="#{ticketController.doAddTicket}" onsuccess="PF('openTicketDialog').hide()" value="Создать" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}"/>
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="closeTicketDialog"
                header="Закрытие заявки:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <!--<p:selectManyCheckbox value="{ticketController.selectedTicketResults}" layout="grid" columns="1">-->
            <!--<f:selectItems value="{ticketController.ticketResults}" var="ticketResult" itemLabel="{ticketResult.toString()}" itemValue="{ticketResult}"/>-->
            <!--</p:selectManyCheckbox>-->
            <p:outputPanel id="closeTicketPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">
                    <h:outputText value="Проведенная работа:" />
                    <p:selectManyMenu value="#{ticketController.selectedTicketResults}" converter="ticketResultConverter" showCheckbox="false" required="true" requiredMessage="пожалуйста, укажите произведенные действия">
                        <f:selectItems value="#{ticketController.ticketResults}" var="ticketResult" itemLabel="#{ticketResult.toString()}" itemValue="#{ticketResult}"/>
                    </p:selectManyMenu>
                    <h:outputText value="Комментарий:"/>
                    <p:inputTextarea rows="5" value="#{ticketController.commentContent}" counter="closeTicketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                    </p:inputTextarea>
                </p:panelGrid>

                <p:separator/>

                <h:outputText id="closeTicketCommentContentCounter" style="margin-bottom: 10px; display: block"/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doCloseTicket}" onsuccess="PF('closeTicketDialog').hide()" value="Закрыть" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}" />
                    <f:setPropertyActionListener value="#{sessionScopedController.ticket}" target="#{ticketController.ticket}" />
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="repeatedOnServiceTicketDialog"
                header="Повторный выезд:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="repeatedOnServiceTicketPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">
                    <h:outputText value="Причина повторного выезда:" />
                    <p:inputTextarea rows="5" value="#{ticketController.commentContent}" counter="repeatedOnServiceTicketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                    </p:inputTextarea>
                </p:panelGrid>

                <p:separator/>

                <h:outputText id="repeatedOnServiceTicketCommentContentCounter" style="margin-bottom: 10px; display: block"/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doRepeatedOnServiceTicket}" onsuccess="PF('repeatedOnServiceTicketDialog').hide()" value="Назначить повторный выезд" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}" />
                    <f:setPropertyActionListener value="#{sessionScopedController.ticket}" target="#{ticketController.ticket}" />
                    <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="repeatedCloseTicketDialog"
                header="Повторное закрытие заявки:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="repeatedCloseTicketPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">
                    <h:outputText value="Проведенная работа:" />
                    <p:selectManyMenu value="#{ticketController.selectedTicketResults}" converter="ticketResultConverter" showCheckbox="false">
                        <f:selectItems value="#{ticketController.ticketResults}" var="ticketResult" itemLabel="#{ticketResult.toString()}" itemValue="#{ticketResult}"/>
                    </p:selectManyMenu>
                    <h:outputText value="Комментарий:" />
                    <p:inputTextarea rows="5" value="#{ticketController.commentContent}" counter="repeatedCloseTicketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                    </p:inputTextarea>
                </p:panelGrid>

                <p:separator/>

                <h:outputText id="repeatedCloseTicketCommentContentCounter" style="margin-bottom: 10px; display: block"/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doRepeatedCloseTicket}" onsuccess="PF('repeatedCloseTicketDialog').hide()" value="Закрыть повторно" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}" />
                    <f:setPropertyActionListener value="#{sessionScopedController.ticket}" target="#{ticketController.ticket}" />
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="markAsIncorrectTicketDialog"
                header="Отметка о невалидности заявки:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="markAsIncorrectTicketPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">
                    <h:outputText value="Причина пометки как невалидной:" />
                    <p:inputTextarea rows="5" value="#{ticketController.commentContent}" counter="markAsIncorrectTicketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                    </p:inputTextarea>
                </p:panelGrid>

                <p:separator/>

                <h:outputText id="markAsIncorrectTicketCommentContentCounter" style="margin-bottom: 10px; display: block"/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doMarkAsIncorrectTicket}" onsuccess="PF('markAsIncorrectTicketDialog').hide()" value="Отметить как невалидную" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}" />
                    <f:setPropertyActionListener value="#{sessionScopedController.ticket}" target="#{ticketController.ticket}" />
                    <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="cancelTicketDialog"
                header="Отмена заявки:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="cancelTicketPanel">
                <p:panelGrid columns="2" styleClass="ui-noborder" style="width: auto">
                    <h:outputText value="Причина отмены заявки:" />
                    <p:inputTextarea rows="5" value="#{ticketController.commentContent}" counter="cancelTicketCommentContentCounter" maxlength="255" counterTemplate="символов осталось: {0}"  required="true" requiredMessage="пожалуйста, укажите комментарий" validatorMessage="количество символов в комментарии должно быть от 3 до 255">
                        <f:validateLength minimum="3" maximum="255"/>
                    </p:inputTextarea>
                </p:panelGrid>

                <p:separator/>

                <h:outputText id="cancelTicketCommentContentCounter" style="margin-bottom: 10px; display: block"/>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doCancelTicket}" onsuccess="PF('cancelTicketDialog').hide()" value="Отменить заявку" icon="ui-icon-disk" style="float: right">
                    <f:setPropertyActionListener value="#{sessionScopedController.unitOfTransport}" target="#{ticketController.unitOfTransport}" />
                    <f:setPropertyActionListener value="#{sessionScopedController.ticket}" target="#{ticketController.ticket}" />
                    <!--<f:setPropertyActionListener value="{didBy}" target="{ticketController.didBy}" />-->
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="showTicketHistoryDialog"
                header="Хронология заявки:"
                modal="false"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="true"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="showTicketHistoryPanel">
                <p:dataTable id="CurrentTicketCondition"
                             widgetVar="CurrentTicketCondition"
                             var="ticketInfo"
                             value="#{ticketController.ticket.ticketInfo}"
                             varStatus="CurrentTicketConditionVarStatus"
                             emptyMessage="хронология не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="Текущее состояние" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{ticketInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{ticketInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Статус">
                        <h:outputText value=" #{ticketInfo.ticketStatus}" />
                    </p:column>

                    <p:column headerText="Результат">
                        <h:outputText value=" #{ticketInfo.ticketResults.size() == 0? '' : ticketInfo.ticketResults}" />
                    </p:column>

                    <p:column headerText="В Уфу">
                        <h:outputText value="#{ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Осмотр">
                        <h:outputText value="#{ticketInfo.ticketDetails.isInspected? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Подача">
                        <h:outputText value="#{ticketInfo.ticketDetails.place}" />
                    </p:column>

                    <p:column headerText="Водитель">
                        <h:outputText value="#{ticketInfo.ticketDetails.mobileNumberOfDriver}" />
                    </p:column>

                    <p:column headerText="Ответственный">
                        <h:outputText value="#{ticketInfo.ticketDetails.mobileNumberOfAgent}" />
                    </p:column>

                    <p:column headerText="Проект">
                        <h:outputText value="#{ticketInfo.transportInfo.project}" />
                    </p:column>

                    <p:column headerText="Филиал">
                        <h:outputText value="#{ticketInfo.transportInfo.branch}" />
                    </p:column>

                    <p:column headerText="Маршрут">
                        <h:outputText value="#{ticketInfo.transportInfo.route}" />
                    </p:column>

                    <p:column headerText="Гос. номер">
                        <h:outputText value="#{ticketInfo.transportInfo.stateNumber}" />
                    </p:column>

                    <p:column headerText="Гар. номер">
                        <h:outputText value="#{ticketInfo.transportInfo.garageNumber}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{ticketInfo.transportInfo.model}" />
                    </p:column>

                    <p:column headerText="Терминал">
                        <h:outputText value="#{ticketInfo.terminalInfo.number}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{ticketInfo.terminalInfo.model}" />
                    </p:column>

                    <p:column headerText="Прошивка">
                        <h:outputText value="#{ticketInfo.terminalInfo.firmware}" />
                    </p:column>

                    <p:column headerText="SN">
                        <h:outputText value="#{ticketInfo.terminalInfo.serialNumber}" />
                    </p:column>

                    <p:column headerText="Телефон">
                        <h:outputText value="#{ticketInfo.terminalInfo.mobileNumber}" />
                    </p:column>

                    <p:column headerText="Связь">
                        <h:outputText value="#{ticketInfo.pointInfo.date}" />
                    </p:column>
                </p:dataTable>

                <p:dataTable id="HistoryTicketCondition"
                             widgetVar="HistoryTicketCondition"
                             var="ticketInfo"
                             value="#{ticketController.ticket.ticketInfoHistory}"
                             varStatus="HistoryTicketConditionVarStatus"
                             emptyMessage="хронология не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="История" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{ticketInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{ticketInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Статус">
                        <h:outputText value=" #{ticketInfo.ticketStatus}" />
                    </p:column>

                    <p:column headerText="Результат">
                        <h:outputText value=" #{ticketInfo.ticketResults.size() == 0? '' : ticketInfo.ticketResults}" />
                    </p:column>

                    <p:column headerText="В Уфу">
                        <h:outputText value="#{ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Осмотр">
                        <h:outputText value="#{ticketInfo.ticketDetails.isInspected? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Подача">
                        <h:outputText value="#{ticketInfo.ticketDetails.place}" />
                    </p:column>

                    <p:column headerText="Водитель">
                        <h:outputText value="#{ticketInfo.ticketDetails.mobileNumberOfDriver}" />
                    </p:column>

                    <p:column headerText="Ответственный">
                        <h:outputText value="#{ticketInfo.ticketDetails.mobileNumberOfAgent}" />
                    </p:column>

                    <p:column headerText="Проект">
                        <h:outputText value="#{ticketInfo.transportInfo.project}" />
                    </p:column>

                    <p:column headerText="Филиал">
                        <h:outputText value="#{ticketInfo.transportInfo.branch}" />
                    </p:column>

                    <p:column headerText="Маршрут">
                        <h:outputText value="#{ticketInfo.transportInfo.route}" />
                    </p:column>

                    <p:column headerText="Гос. номер">
                        <h:outputText value="#{ticketInfo.transportInfo.stateNumber}" />
                    </p:column>

                    <p:column headerText="Гар. номер">
                        <h:outputText value="#{ticketInfo.transportInfo.garageNumber}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{ticketInfo.transportInfo.model}" />
                    </p:column>

                    <p:column headerText="Терминал">
                        <h:outputText value="#{ticketInfo.terminalInfo.number}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{ticketInfo.terminalInfo.model}" />
                    </p:column>

                    <p:column headerText="Прошивка">
                        <h:outputText value="#{ticketInfo.terminalInfo.firmware}" />
                    </p:column>

                    <p:column headerText="SN">
                        <h:outputText value="#{ticketInfo.terminalInfo.serialNumber}" />
                    </p:column>

                    <p:column headerText="Телефон">
                        <h:outputText value="#{ticketInfo.terminalInfo.mobileNumber}" />
                    </p:column>

                    <p:column headerText="Связь">
                        <h:outputText value="#{ticketInfo.pointInfo.date}" />
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="showTransportHistoryDialog"
                header="История (транспорт):"
                modal="false"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="true"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="showTransportHistoryPanel">
                <p:dataTable id="CurrentTransportCondition"
                             widgetVar="CurrentTransportCondition"
                             var="transportInfo"
                             value="#{transportController.unitOfTransport.transportInfo}"
                             varStatus="CurrentTransportConditionVarStatus"
                             emptyMessage="история не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="Текущее состояние" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{transportInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{transportInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Проект">
                        <h:outputText value="#{transportInfo.project}" />
                    </p:column>

                    <p:column headerText="Филиал">
                        <h:outputText value="#{transportInfo.branch}" />
                    </p:column>

                    <p:column headerText="Маршрут">
                        <h:outputText value="#{transportInfo.route}" />
                    </p:column>

                    <p:column headerText="Гос. номер">
                        <h:outputText value="#{transportInfo.stateNumber}" />
                    </p:column>

                    <p:column headerText="Гар. номер">
                        <h:outputText value="#{transportInfo.garageNumber}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{transportInfo.model}" />
                    </p:column>

                    <p:column headerText="Тангента">
                        <h:outputText value="#{transportInfo.transportEquipment.hasPtt? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Динамик">
                        <h:outputText value="#{transportInfo.transportEquipment.hasSpeaker? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Информатор">
                        <h:outputText value="#{transportInfo.transportEquipment.hasInformer? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Регистратор">
                        <h:outputText value="#{transportInfo.transportEquipment.hasDvr? 'да':'нет'}" />
                    </p:column>
                </p:dataTable>

                <p:dataTable id="HistoryTransportCondition"
                             widgetVar="HistoryTransportCondition"
                             var="transportInfo"
                             value="#{transportController.unitOfTransport.transportInfoHistory}"
                             varStatus="HistoryTransportConditionVarStatus"
                             emptyMessage="история не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="История" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{transportInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{transportInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Проект">
                        <h:outputText value="#{transportInfo.project}" />
                    </p:column>

                    <p:column headerText="Филиал">
                        <h:outputText value="#{transportInfo.branch}" />
                    </p:column>

                    <p:column headerText="Маршрут">
                        <h:outputText value="#{transportInfo.route}" />
                    </p:column>

                    <p:column headerText="Гос. номер">
                        <h:outputText value="#{transportInfo.stateNumber}" />
                    </p:column>

                    <p:column headerText="Гар. номер">
                        <h:outputText value="#{transportInfo.garageNumber}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{transportInfo.model}" />
                    </p:column>

                    <p:column headerText="Тангента">
                        <h:outputText value="#{transportInfo.transportEquipment.hasPtt? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Динамик">
                        <h:outputText value="#{transportInfo.transportEquipment.hasSpeaker? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Информатор">
                        <h:outputText value="#{transportInfo.transportEquipment.hasInformer? 'да':'нет'}" />
                    </p:column>

                    <p:column headerText="Регистратор">
                        <h:outputText value="#{transportInfo.transportEquipment.hasDvr? 'да':'нет'}" />
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="showTerminalHistoryDialog"
                header="История (трерминал):"
                modal="false"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="true"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="showTerminalHistoryPanel">
                <p:dataTable id="CurrentTerminalCondition"
                             widgetVar="CurrentTerminalCondition"
                             var="terminalInfo"
                             value="#{transportController.unitOfTransport.terminal.terminalInfo}"
                             varStatus="CurrentTerminalConditionVarStatus"
                             emptyMessage="история не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="Текущее состояние" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{terminalInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{terminalInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Терминал">
                        <h:outputText value="#{terminalInfo.number}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{terminalInfo.model}" />
                    </p:column>

                    <p:column headerText="Прошивка">
                        <h:outputText value="#{terminalInfo.firmware}" />
                    </p:column>

                    <p:column headerText="SN">
                        <h:outputText value="#{terminalInfo.serialNumber}" />
                    </p:column>

                    <p:column headerText="Телефон">
                        <h:outputText value="#{terminalInfo.mobileNumber}" />
                    </p:column>
                </p:dataTable>

                <p:dataTable id="HistoryTerminalCondition"
                             widgetVar="HistoryTerminalCondition"
                             var="terminalInfo"
                             value="#{transportController.unitOfTransport.terminal.terminalInfoHistory}"
                             varStatus="HistoryTerminalConditionVarStatus"
                             emptyMessage="история не найдена..."
                             draggableColumns="true"
                             draggableRows="true"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             editable="false"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal">

                    <f:facet name="header">
                        <h:outputText value="История" />
                    </f:facet>

                    <p:column headerText="Дата">
                        <h:outputText value="#{terminalInfo.modification.date}" />
                    </p:column>

                    <p:column headerText="Кто">
                        <h:outputText value="#{terminalInfo.modification.didBy}" />
                    </p:column>

                    <p:column headerText="Терминал">
                        <h:outputText value="#{terminalInfo.number}" />
                    </p:column>

                    <p:column headerText="Модель">
                        <h:outputText value="#{terminalInfo.model}" />
                    </p:column>

                    <p:column headerText="Прошивка">
                        <h:outputText value="#{terminalInfo.firmware}" />
                    </p:column>

                    <p:column headerText="SN">
                        <h:outputText value="#{terminalInfo.serialNumber}" />
                    </p:column>

                    <p:column headerText="Телефон">
                        <h:outputText value="#{terminalInfo.mobileNumber}" />
                    </p:column>
                </p:dataTable>
            </p:outputPanel>
        </p:dialog>

    </ui:define>

</ui:composition>
</html>




        <!--<h:outputText value="Телефон водителя:" />-->
        <!--<p:inputText value="{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}"/>-->
        <!--<h:outputText value="Телефон ответственного:" />-->
        <!--<p:inputText value="{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}"/>-->

        <!--<c:set var="NOT_ONLINE" value="<=TicketHeader.NOT_ONLINE%>"/>-->
        <!--<c:set var="BAD_TRACK" value="<=TicketHeader.BAD_TRACK%>"/>-->

        <!--<c:if test="{!empty ticket}">-->
        <!--<c:choose>-->
        <!--<c:when test="{ticket.ticketHeader == NOT_ONLINE}">-->
        <!--<c:set var="ticketHeader" value="не на связи!!!" />-->
        <!--</c:when>-->

        <!--<c:when test="{ticket.ticketHeader == BAD_TRACK}">-->
        <!--<c:set var="ticketHeader" value="некорректный трек!!!" />-->
        <!--</c:when>-->

        <!--<c:otherwise>-->
        <!--<c:set var="ticketHeader" value="прочее!!!" />-->
        <!--</c:otherwise>-->
        <!--</c:choose>-->
        <!--<h:outputText value="{ticketHeader}" style="display:block"/>-->

        <!--<c:set value="{ticket.updateDate}" var="ticketUpdateDate"/>-->
        <!--<c:if test="{not empty ticketUpdateDate}">-->
        <!--<h:outputText value="(обновлена!!!: {ticketUpdateDate})"/>-->
        <!--</c:if>-->

        <!--<c:set value="{ticket.closeDate}" var="tiecketClosDate"/>-->
        <!--<c:if test="{not empty fn:trim(tiecketClosDate)}">-->
        <!--<h:outputText value="(закрыта!!!: {tiecketClosDate} / {ticket.closedBy})"/>-->
        <!--</c:if>-->
        <!--</c:if>-->