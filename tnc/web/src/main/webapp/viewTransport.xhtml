<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<ui:composition template="layout.xhtml">

    <ui:define name="title">
        <p:outputLabel style="font-size: small">
            Транспорт
        </p:outputLabel>
    </ui:define>

    <ui:define name="content">
        <p:tabView id="transportTabView" dynamic="true" cache="true" style="font-size: small">
            <p:tab title="Транспорт">
                <p:dataTable id="transportTable"
                             widgetVar="transportTable"
                             var="transport"
                             value="#{transportController.transport}"
                             varStatus="transportVarStatus"
                             filteredValue="#{transportController.filteredTransport}"
                             selection="#{transportController.checkboxSelectedTransport}"
                             rowKey="#{transport.id}"
                             emptyMessage="транспорт не найден..."
                             draggableColumns="true"
                             draggableRows="false"
                             resizableColumns="true"
                             stickyHeader="false"
                             scrollable="false"
                             scrollHeight="500"
                             sortMode="multiple"
                             editable="true"
                             style="margin-bottom:20px; word-wrap: break-word; table-layout: fixed; white-space: normal" >
                    <!--sortBy="null" sortOrder="ascending"-->
                    <!--rowKey="{transport.id}" перестал видеть после добавления varStatus="transportVarStatus"-->

                    <!--TODO change color rowStyleClass="{transport.terminal.number le 7000 ? 'tooday' : 'notTooday'}"-->

                    <c:set var="didBy" value="Администратор"/>
                    <p:ajax event="rowEdit" listener="#{transportController.onRowEdit}" update=":form:msgs" />
                    <p:ajax event="rowEditCancel" listener="#{transportController.onRowCancel}" update=":form:msgs" />

                    <f:facet name="header" >
                        <!--<p:outputPanel style="height: 35px">-->
                        <!--<p:panelGrid>-->
                            <p:toolbar>
                                <f:facet name="left">
                                    <p:commandButton process="@this" value="Добавить" icon="ui-icon-document" update=":form:addTransportPanel" oncomplete="PF('addTransportDialog').show()"/>
                                    <span class="ui-separator">
                                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                                    </span>
                                    <p:commandButton type="button" value="Удалить" icon="ui-icon-folder-open" />

                                    <span class="ui-separator">
                                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                                    </span>

                                    <p:commandButton type="button" title="Save" icon="ui-icon-disk" />
                                    <p:commandButton type="button" title="Delete" icon="ui-icon-trash" />
                                    <p:commandButton type="button" title="Print" icon="ui-icon-print" />

                                    <span class="ui-separator">
                                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                                    </span>

                                    <p:menuButton value="Настройки">
                                        <p:menuitem value="Save"  icon="ui-icon-disk" />
                                        <p:menuitem value="Update"  icon="ui-icon-arrowrefresh-1-w" />
                                        <p:menuitem value="Delete"  icon="ui-icon-close" />
                                        <p:menuitem value="Homepage" url="http://www.primefaces.org" icon="ui-icon-extlink" />
                                    </p:menuButton>
                                </f:facet>

                                <f:facet name="right">
                                    <p:inputText id="globalFilter" onkeyup="PF('transportTable').filter()" placeholder="поиск..."  />

                                    <span class="ui-separator">
                                        <span class="ui-icon ui-icon-grip-dotted-vertical" />
                                    </span>

                                    <p:commandButton id="transportToggler" type="button"  icon="ui-icon-calculator" />
                                    <p:columnToggler datasource="transportTable" trigger="transportToggler" />
                                </f:facet>
                            </p:toolbar>
                        <!--</p:panelGrid>-->
                        <!--</p:outputPanel>-->
                    </f:facet>

                    <p:column headerText="-" selectionMode="multiple" style="width:16px;text-align:center"/>

                    <p:column headerText="-" style="width:16px">
                        <p:rowToggler />
                    </p:column>

                    <p:column headerText="-" style="width:16px">
                        <p:rowEditor />
                    </p:column>

                    <p:column headerText="Проект" sortBy="#{transport.transportInfo.project}" filterBy="#{transport.transportInfo.project}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.projects}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.project}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.project}" style="width:100%"/>
                                <!--id="modelInput" label="Year"-->
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Филиал" sortBy="#{transport.transportInfo.branch}" filterBy="#{transport.transportInfo.branch}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.branches}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.branch}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.branch}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Маршрут" sortBy="#{transport.transportInfo.route}" filterBy="#{transport.transportInfo.route}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.routes}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.route}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.route}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Гос. номер" sortBy="#{transport.transportInfo.stateNumber}" filterBy="#{transport.transportInfo.stateNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.stateNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.stateNumber}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Гар. номер" sortBy="#{transport.transportInfo.garageNumber}" filterBy="#{transport.transportInfo.garageNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.garageNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.garageNumber}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Модель" sortBy="#{transport.transportInfo.model}" filterBy="#{transport.transportInfo.model}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.transportModels}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.transportInfo.model}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.transportInfo.model}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Терминал" sortBy="#{transport.terminal.terminalInfo.number}" filterBy="#{transport.terminal.terminalInfo.number}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.number}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.number}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Модель" sortBy="#{transport.terminal.terminalInfo.model}" filterBy="#{transport.terminal.terminalInfo.model}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.terminalModels}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.model}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.model}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Прошивка" sortBy="#{transport.terminal.terminalInfo.firmware}" filterBy="#{transport.terminal.terminalInfo.firmware}" filterMatchMode="in">
                        <f:facet name="filter">
                            <p:selectCheckboxMenu label="..." onchange="PF('transportTable').filter()" panelStyle="width:200px" scrollHeight="200">
                                <f:selectItems value="#{transportController.firmware}" />
                            </p:selectCheckboxMenu>
                        </f:facet>
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.firmware}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.firmware}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="SN" sortBy="#{transport.terminal.terminalInfo.serialNumber}" filterBy="#{transport.terminal.terminalInfo.serialNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.serialNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.serialNumber}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Телефон" sortBy="#{transport.terminal.terminalInfo.mobileNumber}" filterBy="#{transport.terminal.terminalInfo.mobileNumber}" filterMatchMode="contains">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.terminal.terminalInfo.mobileNumber}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{transport.terminal.terminalInfo.mobileNumber}" style="width:100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Связь" sortBy="#{transport.point.pointInfo.date}" filterBy="#{transport.point.pointInfo.date}" filterMatchMode="contains">

                        <!--style="white-space: normal"-->

                        <!--<p:commandButton id="transportPointButton" update=":form:transportPointPanel" oncomplete="PF('transportPointDialog').show()" icon="ui-icon-pin-s" title="View">-->
                            <!--<f:setPropertyActionListener value="{transport.terminal.lastPoint}" target="{transportController.dialogSelectedPoint}" />-->
                        <!--</p:commandButton>-->

                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{transport.point.pointInfo.date}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:calendar id="datetime" value="#{transport.point.pointInfo.date}" pattern="MM/dd/yyyy HH:mm:ss" />
                                <!--<p:inputText value="{transport.point.pointInfo.date}" style="width:100%"/>-->
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Заявки" sortBy="#{transport.tickets.size()}" filterBy="#{transport.tickets.size()}" filterMatchMode="contains">
                        <h:outputText value="#{transport.tickets.size()}" />
                    </p:column>

                    <p:column headerText="Комментарии" sortBy="#{transport.comments.size()}" filterBy="#{transport.comments.size()}" filterMatchMode="contains">

                        <!--<p:commandButton id="transportCommentsButton" update=":form:transportCommentsPanel" oncomplete="PF('transportCommentsDialog').show()" icon="ui-icon-search" title="View">-->
                            <!--<f:setPropertyActionListener value="{transport}" target="{transportController.dialogSelectedTransport}" />-->
                        <!--</p:commandButton>-->

                        <h:outputText value="#{transport.comments.size()}" />
                    </p:column>

                    <p:rowExpansion>
                        <p:panelGrid style="margin-bottom: 20px">
                            <p:commandLink value="показать на карте" process="@this" update=":form:showPointPanel" action="#{pointController.initModel}" oncomplete="PF('showPointDialog').show()" title="нажмите, чтобы увидеть транспорт на карте">
                                <f:setPropertyActionListener value="#{transport.point}" target="#{pointController.point}" />
                            </p:commandLink>
                        </p:panelGrid>

                        <p:accordionPanel multiple="true" activeIndex="" style="margin-bottom: 20px">
                            <p:tab title="Дополнительное оборудование">
                                <p:panelGrid columns="1" style="border: hidden white; width: auto">
                                    <h:panelGrid columns="1" style="border: hidden white">
                                        <p:panelGrid columns="2" style="width: auto">
                                            <h:outputText value="Тангента:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasPtt? 'В комплекте':'Нет'}" style="display:block">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasPtt}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Динамик:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasSpeaker? 'В комплекте':'Нет'}" style="display:block">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasSpeaker}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Информатор:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasInformer? 'В комплекте':'Нет'}" style="display:block">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasInformer}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>

                                            <h:outputText value="Регистратор:"/>
                                            <p:inplace label="#{transport.transportInfo.transportEquipment.hasDvr? 'В комплекте':'Нет'}" style="display:block">
                                                <p:selectBooleanButton value="#{transport.transportInfo.transportEquipment.hasDvr}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                            </p:inplace>
                                        </p:panelGrid>

                                        <p:commandLink value="обновить" process="@parent" update=":form:msgs @parent:@parent" action="#{transportController.doUpdateTransport}" title="нажмите, чтобы сохранить изменения">
                                            <f:setPropertyActionListener value="#{transport}" target="#{transportController.unitOfTransport}" />
                                        </p:commandLink>
                                    </h:panelGrid>
                                </p:panelGrid>
                            </p:tab>

                            <p:tab title="Комментарии к транспорту">
                                <p:scrollPanel mode="native" style="width: auto; height: auto; max-height: 300px; max-width: 100%; margin-bottom: 10px; padding: 10px">
                                    <ui:repeat value="#{transport.comments}" var="transportComment">
                                        <p:fieldset legend="(#{transportComment.creation.date}) #{transportComment.creation.didBy}:" toggleable="true" toggleSpeed="500" collapsed="false" style="margin-bottom: 10px; width: auto; max-width: 100%" >
                                            <p:panelGrid>
                                                <h:outputText value="#{transportComment.commentInfo.content}" style="width:auto; display:block; word-wrap: break-word; font-style: italic; white-space: normal"/> <!--word-break: break-all;-->
                                                <h:outputText value=" изменен: #{transportComment.commentInfo.modification.date}" style="width:auto; display:block; word-wrap: break-word; font-style: normal; font-weight: bold; white-space: normal"/>
                                            </p:panelGrid>
                                        </p:fieldset>
                                    </ui:repeat>
                                </p:scrollPanel>
                                <p:inputTextarea rows="3" value="#{ticketController.commentContent}" style="display:block; margin-bottom: 10px; width: 50%"/>
                                <p:commandButton id="transportCommentButton" process="@parent" update="@parent:@child(0) @parent:@child(1) :form:msgs" action="#{ticketController.doAddTransportComment(transport, didBy)}" value="Отправить" icon="ui-icon-disk"/>
                            </p:tab>

                            <p:tab title="Заявки">
                                <ui:repeat value="#{transport.tickets}" var="ticket" varStatus="ticketVarStatus">
                                    <p:panel id="ticketPanel#{ticketVarStatus.index}-#{ticket.id}" collapsed="true" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" widgetVar="ticketPanel#{ticketVarStatus.index}-#{ticket.id}" style="margin-bottom: 10px; width: 100%"
                                             header="#{ticketVarStatus.index + 1} - #{ticket.creation.date} (#{ticket.creation.didBy}) - #{ticket.ticketInfo.ticketHeader} (#{ticket.ticketInfo.ticketStatus})"
                                             footer="принята: #{ticket.acceptance.date} (#{ticket.acceptance.didBy}) /// закрыта: #{ticket.closing.date} (#{ticket.closing.didBy}) /// удалена: #{ticket.deletion.date} (#{ticket.deletion.didBy}) /// последнее изменение: #{ticket.ticketInfo.modification.date} (#{ticket.ticketInfo.modification.didBy})">
                                        <!--<p:ajax event="close" listener="{panelView.onClose}" update="msgs" />-->
                                        <!--<p:ajax event="toggle" listener="{panelView.onToggle}" update="msgs" />-->
                                        <p:panelGrid columns="1" style="border: hidden white; width: auto">
                                            <h:panelGrid columns="1" style="border: hidden white">
                                                <p:panelGrid columns="2" style="width: auto">
                                                    <h:outputText value="Возможность подачи в Уфу:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace? 'Есть':'Нет'}" style="display:block">
                                                        <p:selectBooleanButton value="#{ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace}" onLabel="Есть" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                                    </p:inplace>

                                                    <h:outputText value="Внешний осмотр:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.isInspected? 'Произведен':'Не произведен'}" style="display:block">
                                                        <p:selectBooleanButton value="#{ticket.ticketInfo.ticketDetails.isInspected}" onLabel="Произведен" offLabel="Не произведен" onIcon="ui-icon-check" offIcon="ui-icon-close"/>
                                                    </p:inplace>

                                                    <h:outputText value="Место подачи:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.place}" style="display:block">
                                                        <p:inputText value="#{ticket.ticketInfo.ticketDetails.place}" style="width: 380px"/>
                                                    </p:inplace>

                                                    <h:outputText value="Телефон водителя:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}" style="display:block">
                                                        <p:inputText value="#{ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}"/>
                                                    </p:inplace>

                                                    <h:outputText value="Телефон ответственного:"/>
                                                    <p:inplace label="#{ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}" style="display:block">
                                                        <p:inputText value="#{ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}"/>
                                                    </p:inplace>
                                                </p:panelGrid>

                                                <p:commandLink value="обновить" process="@parent" update=":form:msgs @parent:@parent" action="#{ticketController.doUpdateTicketInfo}" title="нажмите, чтобы сохранить изменения">
                                                    <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                    <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                    <f:setPropertyActionListener value="#{didBy}" target="#{ticketController.didBy}" />
                                                </p:commandLink>
                                            </h:panelGrid>
                                        </p:panelGrid>
                                        <p:scrollPanel mode="native" style="width: auto; height: auto; max-height: 300px; max-width: 100%; margin-bottom: 10px; padding: 10px">
                                            <ui:repeat value="#{ticket.comments}" var="ticketComment">
                                                <p:fieldset legend="(#{ticketComment.creation.date}) #{ticketComment.creation.didBy}:" toggleable="true" toggleSpeed="500" collapsed="false" style="margin-bottom: 10px; width: auto; max-width: 100%">
                                                    <p:panelGrid>
                                                        <h:outputText value="#{ticketComment.commentInfo.content}" style="width:auto; display:block; word-wrap: break-word; font-style: italic; white-space: normal"/> <!--word-break: break-all;-->
                                                        <h:outputText value=" изменен: #{ticketComment.commentInfo.modification.date}" style="width:auto; display:block; word-wrap: break-word; font-style: normal; font-weight: bold; white-space: normal"/>
                                                    </p:panelGrid>
                                                </p:fieldset>
                                            </ui:repeat>
                                        </p:scrollPanel>
                                        <p:inputTextarea rows="3" cols="100" value="#{ticketController.commentContent}" style="display:block; margin-bottom: 10px; width: 50%"/>
                                        <p:commandButton id="ticketCommentButton" process="@parent" update="@parent:@child(2) @parent:@child(3) :form:msgs" action="#{ticketController.doAddTicketComment(ticket, didBy)}" value="Отправить" icon="ui-icon-disk"/>
                                        <!--<f:facet name="options">-->
                                            <!--<p:menu>-->
                                                <!--<p:submenu label="Settings">-->
                                                    <!--<p:menuitem value="Toggle" url="#" icon="ui-icon-newwin" onclick="PF('ticketPanel{transportVarStatus.index}{ticketVarStatus.index}').toggle()" />-->
                                                    <!--<p:menuitem value="Remove" url="#" icon="ui-icon-close" onclick="PF('ticketPanel{transportVarStatus.index}{ticketVarStatus.index}').close()" />-->
                                                <!--</p:submenu>-->
                                            <!--</p:menu>-->
                                        <!--</f:facet>-->
                                        <f:facet name="actions">
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText styleClass="ui-icon ui-icon-help" /></h:commandLink>-->
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText styleClass="ui-icon ui-icon-star" /></h:commandLink>-->
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" value="удалить" rendered="#{empty ticket.deletion}"/>-->
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" value="закрыть" rendered="#{empty ticket.closing}"/>-->
                                            <!--<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" value="принять" rendered="#{empty ticket.acceptance and empty ticket.deletion and empty ticket.closing}"/>-->

                                            <!--<p:commandButton value="удалить"/>-->
                                            <!--<p:commandButton value="закрыть"/>-->
                                            <p:commandButton process="@this" action="#{ticketController.doAcceptTicket}" update=":form:transportTabView:transportTable :form:msgs" value="принять" title="нажмите, чтобы принять заявку">
                                                <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}" />
                                                <f:setPropertyActionListener value="#{ticket}" target="#{ticketController.ticket}" />
                                                <f:setPropertyActionListener value="#{didBy}" target="#{ticketController.didBy}" />
                                            </p:commandButton>
                                        </f:facet>
                                    </p:panel>
                                </ui:repeat>
                                <p:panel id="horizontal" header="Новая заявка" collapsed="true" toggleable="true" toggleOrientation="horizontal" style="max-width: 50%" rendered="#{ticketController.doCheckForPossibilityToAddTicket(transport)}">
                                    <p:panelGrid columns="2" style="margin-bottom:10px; width: 100%" cellpadding="5">
                                        <h:outputText value="Причина:" />
                                        <p:selectOneListbox value="#{ticketController.ticket.ticketInfo.ticketHeader}">
                                            <f:selectItems value="#{ticketController.ticketHeaders}" var="ticketHeader" itemLabel="#{ticketHeader.toString()}" itemValue="#{ticketHeader}"/>
                                        </p:selectOneListbox>

                                        <h:outputText value="Возможность подачи в Уфу:" />
                                        <p:selectBooleanButton value="#{ticketController.ticket.ticketInfo.ticketDetails.possibilityOfServiceAtTheDefaultPlace}" onLabel="Есть" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                                        <h:outputText value="Внешний осмотр:" />
                                        <p:selectBooleanButton value="#{ticketController.ticket.ticketInfo.ticketDetails.isInspected}" onLabel="Произведен" offLabel="Не произведен" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                                        <h:outputText value="Место подачи:" />
                                        <p:inputText value="#{ticketController.ticket.ticketInfo.ticketDetails.place}" style="width: 99%"/>

                                        <h:outputText value="Телефон водителя:" />
                                        <p:inputText value="#{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfDriver}"/>

                                        <h:outputText value="Телефон ответственного:" />
                                        <p:inputText value="#{ticketController.ticket.ticketInfo.ticketDetails.mobileNumberOfAgent}"/>

                                        <h:outputText value="Комментарий:" />
                                        <p:inputTextarea rows="5" value="#{ticketController.commentContent}" style="width: 99%"/>

                                        <f:facet name="footer">
                                            <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{ticketController.doAddTicket}" value="Создать" icon="ui-icon-disk" style="float: left">
                                                <f:setPropertyActionListener value="#{transport}" target="#{ticketController.unitOfTransport}"/>
                                                <f:setPropertyActionListener value="#{didBy}" target="#{ticketController.didBy}"/>
                                            </p:commandButton>
                                        </f:facet>
                                    </p:panelGrid>
                                </p:panel>
                            </p:tab>
                        </p:accordionPanel>
                    </p:rowExpansion>
                                <!--<c:set var="NOT_ONLINE" value="<=TicketHeader.NOT_ONLINE%>"/>-->
                                <!--<c:set var="BAD_TRACK" value="<=TicketHeader.BAD_TRACK%>"/>-->

                                <!--<c:if test="{!empty ticket}">-->
                                <!--<c:choose>-->
                                <!--<c:when test="{ticket.ticketHeader == NOT_ONLINE}">-->
                                <!--<c:set var="ticketHeader" value="не на связи!!!" />-->
                                <!--</c:when>-->

                                <!--<c:when test="{ticket.ticketHeader == BAD_TRACK}">-->
                                <!--<c:set var="ticketHeader" value="некорректный трек!!!" />-->
                                <!--</c:when>-->

                                <!--<c:otherwise>-->
                                <!--<c:set var="ticketHeader" value="прочее!!!" />-->
                                <!--</c:otherwise>-->
                                <!--</c:choose>-->
                                <!--<h:outputText value="{ticketHeader}" style="display:block"/>-->

                                <!--<c:set value="{ticket.updateDate}" var="ticketUpdateDate"/>-->
                                <!--<c:if test="{not empty ticketUpdateDate}">-->
                                    <!--<h:outputText value="(обновлена!!!: {ticketUpdateDate})"/>-->
                                <!--</c:if>-->

                                <!--<c:set value="{ticket.closeDate}" var="tiecketClosDate"/>-->
                                <!--<c:if test="{not empty fn:trim(tiecketClosDate)}">-->
                                    <!--<h:outputText value="(закрыта!!!: {tiecketClosDate} / {ticket.closedBy})"/>-->
                                <!--</c:if>-->
                                <!--</c:if>-->
                    <f:facet name="footer">
                        <h:outputText value="всего в базе: #{fn:length(transportController.transport)}" style="font-size: small; text-align:left"/>
                    </f:facet>

                </p:dataTable>
            </p:tab>

            <p:tab title="В норме">
            </p:tab>

            <p:tab title="Заявки">
            </p:tab>

            <p:tab title="Статистика">
            </p:tab>

            <p:tab title="TEST" titleStyle="float: right">
                <!--<p:dataTable var="transport" value="#{transportEJB.findAllTransport()}">-->
                    <!--<p:column headerText="BD_Id_Transport">-->
                        <!--<h:outputText value="#{transport.id}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Проект">-->
                        <!--<h:outputText value="#{transport.project}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Филиал">-->
                        <!--<h:outputText value="#{transport.branch}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Гос. номер">-->
                        <!--<h:outputText value="#{transport.stateNumber}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Гар. номер">-->
                        <!--<h:outputText value="#{transport.garageNumber}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Модель">-->
                        <!--<h:outputText value="#{transport.model}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="BD_Id_Terminal">-->
                        <!--<h:outputText value="#{transport.terminal.id}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Терминал">-->
                        <!--<h:outputText value="#{transport.terminal.number}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Прошивка">-->
                        <!--<h:outputText value="#{transport.terminal.firmware}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Телефон">-->
                        <!--<h:outputText value="#{transport.terminal.mobile}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="BD_Id_Point">-->
                        <!--<h:outputText value="#{transport.terminal.lastPoint.id}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="longitude">-->
                        <!--<h:outputText value="#{transport.terminal.lastPoint.longitude}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="latitude">-->
                        <!--<h:outputText value="#{transport.terminal.lastPoint.latitude}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Связь">-->
                        <!--<h:outputText value="#{transport.terminal.lastPoint.date}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Заявки">-->
                        <!--<h:outputText value="#{transport.terminal.tickets.size()}" />-->
                    <!--</p:column>-->

                    <!--<p:column headerText="Комментарии">-->
                        <!--<h:outputText value="#{transport.comments.size()}" />-->
                    <!--</p:column>-->
                <!--</p:dataTable>-->
            </p:tab>

        </p:tabView>

        <p:dialog
                widgetVar="showPointDialog"
                header="Местоположение транспорта:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="50%"
                style="font-size: small">

            <p:outputPanel id="showPointPanel">
                <p:gmap id="gmap" center="#{pointController.point.pointInfo.latitude}, #{pointController.point.pointInfo.longitude}" model="#{pointController.model}" zoom="5" type="HYBRID" style="width:100%; height:500px" />
            </p:outputPanel>
        </p:dialog>

        <p:dialog
                widgetVar="addTransportDialog"
                header="Добавление транспорта:"
                modal="true"
                showEffect="fade"
                hideEffect="fade"
                resizable="false"
                draggable="false"
                width="auto"
                style="font-size: small">

            <p:outputPanel id="addTransportPanel">
                <p:panelGrid columns="2" style="margin-bottom:10px; width: auto" cellpadding="5">

                    <h:outputText value="Проект:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.project}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.projects}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Филиал:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.branch}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.branches}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Гос. номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.transportInfo.stateNumber}"/>

                    <h:outputText value="Гар. номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.transportInfo.garageNumber}"/>

                    <h:outputText value="Модель транспорта:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.model}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.transportModels}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Маршрут:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.transportInfo.route}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.routes}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Тангента:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasPtt}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Динамик:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasSpeaker}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Информатор:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasInformer}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Регистратор:"/>
                    <p:selectBooleanButton value="#{transportController.unitOfTransport.transportInfo.transportEquipment.hasDvr}" onLabel="В комплекте" offLabel="Нет" onIcon="ui-icon-check" offIcon="ui-icon-close"/>

                    <h:outputText value="Терминал:"/>
                    <p:inputText value="#{transportController.unitOfTransport.terminal.terminalInfo.number}"/>

                    <h:outputText value="Телефон:"/>
                    <p:inputText value="#{transportController.unitOfTransport.terminal.terminalInfo.mobileNumber}"/>

                    <h:outputText value="Модель терминала:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.terminal.terminalInfo.model}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.terminalModels}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Прошивка:"/>
                    <p:selectOneMenu value="#{transportController.unitOfTransport.terminal.terminalInfo.firmware}" editable="true">
                        <f:selectItem itemLabel="*новый или из списка:" itemValue=""/>
                        <f:selectItems value="#{transportController.firmware}"/>
                    </p:selectOneMenu>

                    <h:outputText value="Серийный номер:"/>
                    <p:inputText value="#{transportController.unitOfTransport.terminal.terminalInfo.serialNumber}"/>
                </p:panelGrid>

                <p:commandButton process="@parent" update=":form:msgs :form:transportTabView:transportTable" action="#{transportController.doAddTransport}" onsuccess="PF('addTransportDialog').hide()" value="Создать" icon="ui-icon-disk">
                    <f:setPropertyActionListener value="#{didBy}" target="#{transportController.didBy}"/>
                </p:commandButton>
            </p:outputPanel>
        </p:dialog>

    </ui:define>

</ui:composition>
</html>
